(def constant PLANE_ICON_NAMES [
	'planes_hangar_rocket_HE', 
	'planes_hangar_bomb_HE', 
	'planes_hangar_bomb_AP',
	'planes_hangar_skip', 
	'planes_hangar_skip',
	'planes_hangar_torpedo', 
	'planes_hangar_torpedo_deepwater', 
	'planes_hangar_rocket_AP'
])

(def element HangarItemRenderer(col:gfx) layout=true
	(scope
		(event evMouseOver)
		(event evMouseOut)
		(var squadronEntity:gfx = "col.items[$index]" (event "col.evAdded") (event "col.evRemoved") (event "col.evUpdated"))
		(var ammoType:number = "squadronEntity.plane.ammoType")

		(var hangarEntity:gfx = "$datahub.getPrimaryEntity(CC.hangar, squadronEntity.ownSquadron.id)")
		(var curPlanesInHangar:number = "hangarEntity ? hangarEntity.hangar.planeCount : 0" (event "hangarEntity.hangar.evChanged"))
		(var planeIconPath:str = "'url:../aircraft/hangar_icons/' + PLANE_ICON_NAMES[ammoType] + '.png'")

		(var isRollOver:bool = false)
		(bind isRollOver true  init=false (event "evMouseOver"))
		(bind isRollOver false init=false (event "evMouseOut"))
	)

	(style
		(width = 32px)
		(bind marginLeft "$index == 0 ? 16 : 14")
	)

	(block
		(style (position = "absolute") (left = -129) (bottom = 50px))
		(bind alpha "isRollOver ? 0 : 0")
		(bind visible "isRollOver")
		(controller $Animation layout=false
			(bindcall play duration=0.1 delay=0.1 to={alpha:1} killAll=true (bind enabled "isRollOver"))
		)
		(controller $Instance renderer='HangarItemTooltip'
			(bind enabled "isRollOver")
			(args
				__squadronEntityId = "squadronEntity.id"
			)
			(exprs
				(scope
					(bind _squadronEntityId  "squadronEntity.id")
					(bind _planeIconPath  "planeIconPath")
				)
			)
		)
	)

	(block
		(block
			(style
				(position = "absolute")
				(bottom = 0)
				(width = 30px) (height = 30px)
				(bind backgroundImage "planeIconPath")
			)

			(bind alpha "(curPlanesInHangar > 0 ? 1 : 0.5)")
		)

		(block
			(element PlaneReloadProgressAndAttackersBar _squadronEntityId = "squadronEntity.id"
				(scope
					(bind squadronEntityId "squadronEntity.id")
					(bind _width "30")
				)
			)
		)
	)

	
	(block
		(style (position = "absolute") (width = 30) (height = 50) (backgroundColor = 0x00FFFFFF))
		(dispatch evMouseOver on='rollOver')
		(dispatch evMouseOut on='rollOut')
	)
)

(def element HangarItemTooltip(__squadronEntityId:number) layout=true
	(scope
		(var _squadronEntityId:number = "__squadronEntityId")
		(var _planeIconPath:str = '')
		(var squadronEntity:gfx = "_squadronEntityId > -1 ? $datahub.getEntity(_squadronEntityId) : null")
		(var hangarEntity:gfx = "$datahub.getPrimaryEntity(CC.hangar, squadronEntity.ownSquadron.id)")
		(var hangar:gfx = "hangarEntity.hangar")
		(var planeCount:number = "hangar.planeCount")
		(var maxPlanesInSquadron:number = "squadronEntity.health.max")
		(var maxPlaneCount:number = "hangar.maxPlaneCount")
		(var timeToRestore:number = "hangar.timeToRestore" (event "hangar.evChanged"))
		(var ammoType:number = "squadronEntity.plane.ammoType")
		(var planesInAttacker:number = "squadronEntity.ownSquadron.attackerSize")
		(var numAttakers:number = "maxPlanesInSquadron && planesInAttacker ? floor(maxPlanesInSquadron / planesInAttacker) : 0")

		(var squadronType:str = " 		ammoType == SC.Common.PLANE_AMMO_TYPES.PROJECTILE			?  tr('IDS_DOCK_AMMO_TITLE_FIGHTER'):
										ammoType == SC.Common.PLANE_AMMO_TYPES.PROJECTILE_AP		?  tr('IDS_DOCK_AMMO_TITLE_FIGHTER_AP'):
										ammoType == SC.Common.PLANE_AMMO_TYPES.BOMB_HE 				?  tr('IDS_DOCK_AMMO_TITLE_DIVE'):
										ammoType == SC.Common.PLANE_AMMO_TYPES.BOMB_AP				?  tr('IDS_DOCK_AMMO_TITLE_DIVE_AP'):
										ammoType == SC.Common.PLANE_AMMO_TYPES.TORPEDO				?  tr('IDS_DOCK_AMMO_TITLE_BOMBER'):
										ammoType == SC.Common.PLANE_AMMO_TYPES.TORPEDO_DEEPWATER	?  tr('IDS_DOCK_AMMO_TITLE_BOMBER_DEEPWATER'):
										ammoType == SC.Common.PLANE_AMMO_TYPES.SKIP_BOMB_HE			?  tr('IDS_DOCK_AMMO_TITLE_SKIP'):
										ammoType == SC.Common.PLANE_AMMO_TYPES.SKIP_BOMB_AP			?  tr('IDS_DOCK_AMMO_TITLE_SKIP_AP')
																									:  ''")

		(var attributesNeutral:array ="[	{attributeIDS: 'IDS_HANGAR_SQUADRON_PLANES_CURRENT',		measuredValue: planeCount,			measure: ''},
											{attributeIDS: 'IDS_HANGAR_SQUADRON_PLANES_MAX',			measuredValue: maxPlanesInSquadron,	measure: ''},
											{attributeIDS: 'IDS_HANGAR_SQUADRON_PLANES_TIME_RESTORE',	measuredValue: timeToRestore,		measure: 'IDS_SECOND'},
											{attributeIDS: 'IDS_HANGAR_SIZE',							measuredValue: maxPlaneCount,		measure: ''},
											{attributeIDS: 'IDS_HANGAR_SQUADRON_NUM_ATTACKERS',			measuredValue: numAttakers,			measure: ''},
											{attributeIDS: 'IDS_HANGAR_SQUADRON_PLANES_IN_ATTACKER',	measuredValue: planesInAttacker,	measure: ''}]"
											)
	)

	(style (width = 320px))
	(mouseChildren = false)
	(mouseEnabled = false)

	(block
		(class $FullsizeAbsolute)
		(element HangarItemTooltipBackground _isInBattle = true)
	)

	
	(block
		(style (width = 100%) (marginLeft = 2px) (marginRight = 2px))

		(hblock
			(style
				(width = 100%)
				(paddingLeft = "M") (paddingRight = "M")
				(marginTop = "M") (marginBottom = "M")
				(align = "middle")
			)
			(block
				(style
					(width = 30px) (height = 30px)
					(bind backgroundImage "_planeIconPath")
				)
			)
			(tf
				(style (marginLeft = "SXS") (width = 100%))
				(class $TextDefaultBold18NM)
				(bind text "squadronType")
			)
		)

		(block
			(style (width = 100%))
			(element HorizontalDivider)
		)

		(block
			(style (width = 100%))
			
			(mc inner_panel
				(alpha = 1)
				(class $FullsizeAbsolute)
			)
			(block
				(style (width = 100%) (paddingLeft = "SXS") (paddingRight = "SXS") (paddingTop = 18px) (paddingBottom = "-XS"))
				(controller $Repeat renderer='ParamsModifierItem' layout=false
					(bind count "attributesNeutral.length")
					(args
						_shrinkHeight = true
						_category = "AttributeModifiersCategory.NEUTRAL"
						__dataItem = "attributesNeutral[$index]"
					)
					(exprs
						(scope
							(bind _dataItem "attributesNeutral[$index]")
						)
					)
				)
			)
		)
	)
)

(def element HangarItemTooltipBackground(_isInBattle:bool = false) layout=true
	(scope
		(var optionDataEntity:gfx = "$datahub.getSingleEntity(CC.optionData)")
		(var blurEnabled:bool = "optionDataEntity.optionData.blurEnabled" (event "optionDataEntity.optionData.evBlurEnabledChanged"))
		(var contrast:bool = "optionDataEntity.optionData.contrast" (event "optionDataEntity.optionData.evContrastChanged"))
	)
	(class $FullsizeAbsolute)
	(block
		(class $FullsizeAbsolute)
		
		
		
	)
	(mc contrast_panel
		(class $FullsizeAbsolute)
		(alpha = 1)
		(bind visible "(contrast == true || _isInBattle == true)")
	)
	(block
		(class $FullsizeAbsolute)
		(bind visible "!_isInBattle")
		(mc hint_panel
			(class $FullsizeAbsolute)
		)
	)
)